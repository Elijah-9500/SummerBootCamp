<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Elijah Rattray Fun Site</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0; padding: 0;
  }
  header, footer {
    background: #000000;
    padding: 10px;
    text-align: center;
  }
  header h1 {
    color: #ff00ea;
    font-style: italic;
    margin: 0;
  }
  nav ul {
    list-style: none;
    padding: 0; margin: 10px 0 0;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  nav a {
    text-decoration: none;
    color: rgb(250, 250, 250);
  }
  .content {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    padding: 20px;
  }
  .card {
    border: 1px solid #111010;
    padding: 20px;
    min-width: 20%;
    max-width: 30%px;
    box-sizing: border-box;
  }
  #missileCanvas {
    position: absolute;
    pointer-events: none;
    top: 0; left: 0;
    z-index: 10;
  }
</style>
</head>
<body>
<header>
  <h1>Elijah Rattray</h1>
  <nav>
    <ul>
      <li><a href="./index.html">Home</a></li>
      <li><a href="./pages/about.html">About Me</a></li>
      <li><a href="./pages/dino_game.html">Dino Game</a></li>
      <li><a href="./pages/tetris_game.html">Tetris</a></li>
    </ul>
  </nav>
</header>

<main>
  <div class="content">
    <!-- Counter -->
    <section class="card" aria-label="Counter Section">
      <h2 id="counter-title" tabindex="0" role="button" aria-pressed="false" style="cursor:pointer;">Counter</h2>
      <p id="counter-value" aria-live="polite" style="font-size:2rem;">0</p>
      <button id="btn-down" aria-label="Decrease counter">Down</button>
      <button id="btn-up" aria-label="Increase counter">Up</button>
    </section>

    <!-- Pong Game -->
    <section class="card" aria-label="Pong Game Section">
      <h2>Pong Game</h2>
      <canvas id="pongCanvas" width="400" height="200" aria-label="Pong game canvas"></canvas>
    </section>

    <!-- Missile Launcher -->
    <section class="card" aria-label="Missile Launcher Section">
      <h2>Missile Launcher</h2>
      <canvas id="siloCanvas" width="400" height="200" aria-label="Missile silo canvas"></canvas>
      <button id="fireMissile" aria-label="Fire missile">Fire Missile</button>
    </section>
  </div>

  <canvas id="missileCanvas" aria-hidden="true"></canvas>
</main>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    // ====== Counter ======
    let count = 0;
    let hammerUnlocked = false;
    let siloDestroyed = false;
    let coinRevealed = false;

    const counterValue = document.getElementById('counter-value');
    const counterTitle = document.getElementById('counter-title');
    const btnUp = document.getElementById('btn-up');
    const btnDown = document.getElementById('btn-down');

    function updateCounter() {
      counterValue.textContent = count;
    }

    btnUp.addEventListener('click', () => {
      count++;
      updateCounter();
    });

    btnDown.addEventListener('click', () => {
      count--;
      updateCounter();
    });

    counterTitle.addEventListener('click', () => {
      if (count === -13 && !hammerUnlocked) {
        hammerUnlocked = true;
        // After a delay, destroy silo and reveal coin
        setTimeout(() => {
          siloDestroyed = true;
          coinRevealed = true;
          drawSilo();
        }, 1000);
      }
    });

    // Initialize counter display
    updateCounter();


    // ====== Pong Game ======
    const pongCanvas = document.getElementById('pongCanvas');
    const pongCtx = pongCanvas.getContext('2d');

    let ball = { x: 200, y: 100, dx: 2, dy: -2, radius: 10 };
    let paddle = { x: 150, width: 100, height: 10 };
    let coin = { x: 300, y: 80, radius: 8 };
    let coinCollected = false;
    let showWinMessage = false;

    let rightPressed = false;
    let leftPressed = false;

    // Keyboard controls
    window.addEventListener('keydown', (e) => {
      if (e.key === '') rightPressed = true;
      else if (e.key === 'A') leftPressed = true;
    });

    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowRight') rightPressed = false;
      else if (e.key === 'ArrowLeft') leftPressed = false;
    });

    function drawPongGame() {
      // Clear canvas
      pongCtx.clearRect(0, 0, pongCanvas.width, pongCanvas.height);

      // Background
      pongCtx.fillStyle = '#000000';
      pongCtx.fillRect(0, 0, pongCanvas.width, pongCanvas.height);

      // Paddle
      pongCtx.fillStyle = '#ffffff';
      pongCtx.fillRect(paddle.x, pongCanvas.height - paddle.height, paddle.width, paddle.height);

      // Ball
      pongCtx.beginPath();
      pongCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      pongCtx.fillStyle = '#ffffff';
      pongCtx.fill();

      // Coin (only if revealed and not collected)
      if (coinRevealed && !coinCollected) {
        pongCtx.beginPath();
        pongCtx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
        pongCtx.fillStyle = '#996633';
        pongCtx.fill();
      }

      // Win message
      if (showWinMessage) {
        pongCtx.fillStyle = 'ff00ea';
        pongCtx.font = '20px Arial';
        pongCtx.fillText('You Win!', 150, 100);
      }

      // Move ball if coin not collected
      if (!coinCollected) {
        ball.x += ball.dx;
        ball.y += ball.dy;

        // Bounce off walls
        if (ball.x < ball.radius || ball.x > pongCanvas.width - ball.radius) ball.dx *= -1;
        if (ball.y < ball.radius) ball.dy *= -1;

        // Bounce off paddle
        if (ball.y + ball.dy > pongCanvas.height - ball.radius) {
          if (ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
            ball.dy *= -1;
          }
        }

        // Check ball-coin collision
        if (coinRevealed && !coinCollected) {
          const dist = Math.hypot(ball.x - coin.x, ball.y - coin.y);
          if (dist < ball.radius + coin.radius) {
            coinCollected = true;
            setTimeout(() => {
              showWinMessage = true;
            }, 500);
          }
        }
      }

      // Move paddle
      if (rightPressed && paddle.x + paddle.width < pongCanvas.width) paddle.x += 5;
      if (leftPressed && paddle.x > 0) paddle.x -= 5;

      requestAnimationFrame(drawPongGame);
    }
    drawPongGame();


    // ====== Silo Drawing ======
    const siloCanvas = document.getElementById('siloCanvas');
    const siloCtx = siloCanvas.getContext('2d');
    const silo = { x: 170, y: 150, width: 60, height: 30 };

    function drawSilo() {
      // Clear silo canvas
      siloCtx.clearRect(0, 0, siloCanvas.width, siloCanvas.height);

      // Background
      siloCtx.fillStyle = '#eee';
      siloCtx.fillRect(0, 0, siloCanvas.width, siloCanvas.height);

      if (!siloDestroyed) {
        // Draw silo
        siloCtx.fillStyle = 'black';
        siloCtx.fillRect(silo.x, silo.y, silo.width, silo.height);
      }
    }
    drawSilo();


    // ====== Missile Launcher ======
    const missileCanvas = document.getElementById('missileCanvas');
    const mCtx = missileCanvas.getContext('2d');

    function resizeMissileCanvas() {
      missileCanvas.width = window.innerWidth;
      missileCanvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeMissileCanvas);
    resizeMissileCanvas();

    let missileLaunched = false;

    document.getElementById('fireMissile').addEventListener('click', () => {
      if (!missileLaunched && !siloDestroyed) {
        launchMissile();
      }
    });

    function launchMissile() {
      missileLaunched = true;

      const siloRect = siloCanvas.getBoundingClientRect();
      let missile = {
        x: siloRect.left + silo.x + silo.width / 2,
        y: siloRect.top + silo.y,
        angle: -Math.PI / 2,
        speed: 5,
      };

      function updateMissile() {
        mCtx.clearRect(0, 0, missileCanvas.width, missileCanvas.height);

        const pongRect = pongCanvas.getBoundingClientRect();
        const targetX = pongRect.left + ball.x;
        const targetY = pongRect.top + ball.y;

        const dx = targetX - missile.x;
        const dy = targetY - missile.y;
        const desiredAngle = Math.atan2(dy, dx);

        // Normalize angle difference between -PI and PI
        let angleDiff = ((desiredAngle - missile.angle + Math.PI) % (2 * Math.PI)) - Math.PI;

        const maxTurn = 0.05;
        missile.angle += Math.sign(angleDiff) * Math.min(maxTurn, Math.abs(angleDiff));

        missile.x += missile.speed * Math.cos(missile.angle);
        missile.y += missile.speed * Math.sin(missile.angle);

        // Draw missile as a rotated rectangle
        mCtx.save();
        mCtx.translate(missile.x, missile.y);
        mCtx.rotate(missile.angle + Math.PI / 2);
        mCtx.fillStyle = 'red';
        mCtx.fillRect(-5, -10, 10, 20);
        mCtx.restore();

        // Check collision with ball
        const distance = Math.hypot(missile.x - targetX, missile.y - targetY);
        if (distance < ball.radius) {
          missileLaunched = false;
          siloDestroyed = true;
          coinRevealed = true;
          drawSilo();
          mCtx.clearRect(0, 0, missileCanvas.width, missileCanvas.height);
          return;
        }

        // Remove missile if out of screen bounds
        if (
          missile.x < 0 || missile.x > missileCanvas.width ||
          missile.y < 0 || missile.y > missileCanvas.height
        ) {
          missileLaunched = false;
          mCtx.clearRect(0, 0, missileCanvas.width, missileCanvas.height);
          return;
        }

        requestAnimationFrame(updateMissile);
      }

      updateMissile();
    }
  });
</script>
</body>
</html>