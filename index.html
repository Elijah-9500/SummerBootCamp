<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elijah Rattray Fun Site</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
    }

    header, footer {
      background: #f0f0f0;
      padding: 10px;
      text-align: center;
    }

    .content {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      padding: 20px;
      gap: 20px;
      flex-wrap: wrap;
    }

    .card {
      flex: 1;
      min-width: 300px;
      border: 1px solid #ccc;
      padding: 20px;
    }

    canvas {
      background: #eee;
      display: block;
      margin-top: 10px;
    }

    #missileCanvas {
      position: absolute;
      pointer-events: none;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <header>
    <h1 style="color: #ff00ea; font-style: italic;">Elijah Rattray</h1>
    <ul style="list-style: none; display: flex; justify-content: center; gap: 20px;">
      <li><a href="./index.html">Home</a></li>
      <li><a href="./pages/about.html">ABOUT ME</a></li>
    </ul>
  </header>

  <main>
    <div class="content">
      <!-- Counter Card -->
      <div class="card">
        <section id="counter-section">
          <h2 id="counter-title">Counter</h2>
          <p id="counter">0</p>
          <button id="downBtn">Down</button>
          <button id="upBtn">Up</button>
        </section>
      </div>

      <!-- Pong Game Card -->
      <div class="card">
        <h2>Ping Pong Game</h2>
        <canvas id="pongCanvas" width="400" height="200"></canvas>
      </div>

      <!-- Missile Launcher Card -->
      <div class="card">
        <h2>Missile Launcher</h2>
        <canvas id="siloCanvas" width="400" height="200"></canvas>
        <button id="fireMissileBtn">Fire Missile</button>
      </div>
    </div>
    <canvas id="missileCanvas"></canvas>
  </main>

  <footer>
    <p>GitHub: <a href="#">My GitHub</a></p>
    <p>Social Media:
      <a href="https://www.facebook.com/" target="_blank">Facebook</a>
    </p>
  </footer>

  <script>
    // Global elements
    const counterDisplay = document.getElementById("counter");
    const downBtn = document.getElementById("downBtn");
    const upBtn = document.getElementById("upBtn");
    const counterTitle = document.getElementById("counter-title");

    let count = 0;
    let hammerSpawned = false;
    let siloDestroyed = false;
    let coinRevealed = false;
    let missileLaunched = false;

    // Counter logic
    downBtn.onclick = () => { count--; updateCounter(); };
    upBtn.onclick = () => { count++; updateCounter(); };

    function updateCounter() {
      counterDisplay.textContent = count;
    }

    // Pong game setup
    const pongCanvas = document.getElementById("pongCanvas");
    const pongCtx = pongCanvas.getContext("2d");

    let ball = { x: 200, y: 100, dx: 2, dy: -2, radius: 10 };
    let paddle = { x: 150, width: 100, height: 10 };
    let coin = { x: 300, y: 80, radius: 8 };
    let rightPressed = false, leftPressed = false;
    let coinCollected = false;
    let showWinMessage = false;

    document.addEventListener("keydown", e => {
      if (e.key === "ArrowRight") rightPressed = true;
      if (e.key === "ArrowLeft") leftPressed = true;
    });

    document.addEventListener("keyup", e => {
      if (e.key === "ArrowRight") rightPressed = false;
      if (e.key === "ArrowLeft") leftPressed = false;
    });

    function drawPongGame() {
      pongCtx.clearRect(0, 0, pongCanvas.width, pongCanvas.height);

      // Paddle
      pongCtx.fillStyle = "black";
      pongCtx.fillRect(paddle.x, pongCanvas.height - paddle.height, paddle.width, paddle.height);

      // Ball
      pongCtx.beginPath();
      pongCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      pongCtx.fillStyle = "black";
      pongCtx.fill();

      // Coin
      if (coinRevealed && !coinCollected) {
        pongCtx.beginPath();
        pongCtx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
        pongCtx.fillStyle = "#b87333";
        pongCtx.fill();
      }

      // Win
      if (showWinMessage) {
        pongCtx.fillStyle = "green";
        pongCtx.font = "20px Arial";
        pongCtx.fillText("You Win!", 150, 100);
      }

      // Move ball
      if (!coinCollected) {
        ball.x += ball.dx;
        ball.y += ball.dy;

        if (ball.x < ball.radius || ball.x > pongCanvas.width - ball.radius) ball.dx *= -1;
        if (ball.y < ball.radius) ball.dy *= -1;

        if (ball.y + ball.dy > pongCanvas.height - ball.radius) {
          if (ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
            ball.dy *= -1;
          }
        }

        // Coin collision
        if (coinRevealed && !coinCollected) {
          const dist = Math.hypot(ball.x - coin.x, ball.y - coin.y);
          if (dist < ball.radius + coin.radius) {
            coinCollected = true;
            setTimeout(() => showWinMessage = true, 1000);
          }
        }
      }

      // Move paddle
      if (rightPressed && paddle.x + paddle.width < pongCanvas.width) paddle.x += 5;
      if (leftPressed && paddle.x > 0) paddle.x -= 5;

      requestAnimationFrame(drawPongGame);
    }

    drawPongGame();

    // Missile launcher + silo
    const siloCanvas = document.getElementById("siloCanvas");
    const siloCtx = siloCanvas.getContext("2d");
    const fireMissileBtn = document.getElementById("fireMissileBtn");

    const silo = { x: 170, y: 150, width: 60, height: 30 };

    function drawSilo() {
      siloCtx.clearRect(0, 0, siloCanvas.width, siloCanvas.height);
      if (!siloDestroyed) {
        siloCtx.fillStyle = "black";
        siloCtx.fillRect(silo.x, silo.y, silo.width, silo.height);
      }
    }

    drawSilo();

    counterTitle.addEventListener("click", () => {
      if (count === -13 && !hammerSpawned) {
        hammerSpawned = true;
        // Simulate dragging hammer onto silo:
        setTimeout(() => {
          siloDestroyed = true;
          drawSilo();
          coinRevealed = true;
        }, 1000);
      }
    });

    // Missile canvas
    const missileCanvas = document.getElementById("missileCanvas");
    const mCtx = missileCanvas.getContext("2d");

    function resizeMissileCanvas() {
      missileCanvas.width = window.innerWidth;
      missileCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeMissileCanvas);
    resizeMissileCanvas();

    fireMissileBtn.addEventListener("click", () => {
      if (!missileLaunched && !siloDestroyed) launchMissile();
    });

    function launchMissile() {
      missileLaunched = true;
      const rect = siloCanvas.getBoundingClientRect();
      let mx = rect.left + silo.x + silo.width / 2;
      let my = rect.top + silo.y;

      let missile = {
        x: mx,
        y: my,
        angle: -Math.PI / 2,
        speed: 5
      };

      function updateMissile() {
        mCtx.clearRect(0, 0, missileCanvas.width, missileCanvas.height);

        const pongRect = pongCanvas.getBoundingClientRect();
        const targetX = pongRect.left + ball.x;
        const targetY = pongRect.top + ball.y;

        const dx = targetX - missile.x;
        const dy = targetY - missile.y;
        const desiredAngle = Math.atan2(dy, dx);
        const angleDiff = ((desiredAngle - missile.angle + Math.PI) % (2 * Math.PI)) - Math.PI;
        const maxTurn = 0.05;
        missile.angle += Math.sign(angleDiff) * Math.min(maxTurn, Math.abs(angleDiff));

        missile.x += missile.speed * Math.cos(missile.angle);
        missile.y += missile.speed * Math.sin(missile.angle);

        // Draw rotated missile
        mCtx.save();
        mCtx.translate(missile.x, missile.y);
        mCtx.rotate(missile.angle + Math.PI / 2);
        mCtx.fillStyle = "red";
        mCtx.fillRect(-5, -10, 10, 20);
        mCtx.restore();

        const distance = Math.hypot(missile.x - targetX, missile.y - targetY);
        if (distance < ball.radius) {
          missileLaunched = false;
          return;
        }

        if (missile.x < 0 || missile.x > window.innerWidth || missile.y < 0 || missile.y > window.innerHeight) {
          missileLaunched = false;
          return;
        }

        requestAnimationFrame(updateMissile);
      }

      updateMissile();
    }
  </script>
</body>
</html>
